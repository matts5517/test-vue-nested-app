{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/layers/TileLayer.js","webpack:///./node_modules/@arcgis/core/layers/support/Tilemap.js","webpack:///./node_modules/@arcgis/core/layers/support/TilemapCache.js","webpack:///./node_modules/@arcgis/core/layers/support/serviceTileInfoProperty.js","webpack:///./node_modules/@arcgis/core/layers/mixins/ArcGISCachedService.js"],"names":["I","M","e","super","this","listMode","isReference","operationalLayerType","resampling","sourceJSON","spatialReference","path","sublayers","type","url","r","signal","addResolvingPromise","loadFromPortal","supportedTypes","catch","then","_fetchService","Promise","resolve","parsedUrl","toLowerCase","_getDefaultAttribution","_getMapName","tileInfo","fromJSON","t","s","loaded","i","slice","reverse","flatten","toArray","o","a","writeSublayerStructure","forEach","write","push","some","Object","keys","length","layers","_getDefaultTileServers","Array","isArray","map","timestamp","l","getTileUrl","n","responseType","query","_ts","data","tilemapCache","supportsBlankTile","blankTile","customParameters","token","apiKey","tileServers","bandCount","pixelSizeX","serverType","f","ssl","replace","read","origin","version","_fetchServerVersion","currentVersion","reject","match","indexOf","search","fetchTile","__isDefault__","readOnly","prototype","Boolean","json","enabled","overridePolicy","String","origins","C","location","left","top","width","height","_allAvailability","byteSize","_tileAvailabilityBitSet","Math","ceil","Uint8Array","service","request","row","col","h","c","m","d","details","httpStatus","valid","response","definition","validateJSON","freeze","_updateFromData","level","w","T","getLogger","j","_handles","_pendingTilemapRequests","_availableLevels","levels","cacheByteSize","_prefetchingEnabled","_tilemapCache","add","watch","_initializeTilemapDefinition","_initializeAvailableLevels","destroy","error","_tmpTilemapDefinition","_tilemapFromCache","fromDefinition","put","getAvailability","layer","updateTileInfo","upsampleTile","fetchTilemap","fetchAvailability","fetchAvailabilityUpsample","_fetchAvailabilityUpsamplePrefetch","id","has","abort","remove","v","p","_prefetches","_maxPrefetch","removeUnordered","clear","size","get","hasTilemap","initialSize","constructOnly","Number","source","reader","minScale","maxScale","minLOD","maxLOD","ignoreMinMaxLOD","lods","filter","round","scale","arguments","copyright","capabilities"],"mappings":"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","file":"js/chunk-20e837a3.21e00dae.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import\"../geometry.js\";import r from\"../request.js\";import t from\"../core/Error.js\";import{HandleOwnerMixin as s}from\"../core/HandleOwner.js\";import{isSome as i}from\"../core/maybe.js\";import{MultiOriginJSONMixin as o}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as a}from\"../core/promiseUtils.js\";import{urlToObject as l,objectToQuery as n,makeAbsolute as p}from\"../core/urlUtils.js\";import{property as c}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import{cast as u}from\"../core/accessorSupport/decorators/cast.js\";import\"../core/Logger.js\";import{reader as m}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as h}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as d}from\"../core/accessorSupport/decorators/writer.js\";import y from\"./Layer.js\";import{APIKeyMixin as f}from\"./mixins/APIKeyMixin.js\";import{ArcGISCachedService as v}from\"./mixins/ArcGISCachedService.js\";import{ArcGISMapService as g}from\"./mixins/ArcGISMapService.js\";import{ArcGISService as _}from\"./mixins/ArcGISService.js\";import{BlendLayer as S}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as j}from\"./mixins/CustomParametersMixin.js\";import{OperationalLayer as b}from\"./mixins/OperationalLayer.js\";import{PortalLayer as T}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as w}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as O}from\"./mixins/ScaleRangeLayer.js\";import{SublayersOwner as L}from\"./mixins/SublayersOwner.js\";import{parse as R,isHostedAgolService as x,isArcGISUrl as U}from\"./support/arcgisLayerUrl.js\";import{url as P}from\"./support/commonProperties.js\";import A from\"./support/Sublayer.js\";import W from\"../geometry/SpatialReference.js\";const I=[\"Canvas/World_Dark_Gray_Base\",\"Canvas/World_Dark_Gray_Reference\",\"Canvas/World_Light_Gray_Base\",\"Canvas/World_Light_Gray_Reference\",\"Elevation/World_Hillshade\",\"Elevation/World_Hillshade_Dark\",\"Ocean/World_Ocean_Base\",\"Ocean/World_Ocean_Reference\",\"Ocean_Basemap\",\"Reference/World_Boundaries_and_Places\",\"Reference/World_Boundaries_and_Places_Alternate\",\"Reference/World_Transportation\",\"World_Imagery\",\"World_Street_Map\",\"World_Topo_Map\"];let M=class extends(S(L(O(w(b(T(v(g(_(o(s(f(j(y)))))))))))))){constructor(...e){super(...e),this.listMode=\"show\",this.isReference=null,this.operationalLayerType=\"ArcGISTiledMapServiceLayer\",this.resampling=!0,this.sourceJSON=null,this.spatialReference=null,this.path=null,this.sublayers=null,this.type=\"tile\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const r=i(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).catch(a).then((()=>this._fetchService(r)))),Promise.resolve(this)}get attributionDataUrl(){var e;const r=null==(e=this.parsedUrl)?void 0:e.path.toLowerCase();return r&&this._getDefaultAttribution(this._getMapName(r))}readSpatialReference(e,r){return(e=e||r.tileInfo&&r.tileInfo.spatialReference)&&W.fromJSON(e)}writeSublayers(e,r,t,s){if(!this.loaded||!e)return;const i=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray(),o=[],a={writeSublayerStructure:!1,...s};i.forEach((e=>{const r=e.write({},a);o.push(r)}));o.some((e=>Object.keys(e).length>1))&&(r.layers=o)}get tileServers(){return this._getDefaultTileServers(this.parsedUrl.path)}castTileServers(e){return Array.isArray(e)?e.map((e=>l(e).path)):null}fetchTile(e,t,s,i={}){const{signal:o,timestamp:a}=i,l=this.getTileUrl(e,t,s),n={responseType:\"image\",signal:o};return null!=a&&(n.query={_ts:i.timestamp}),r(l,n).then((e=>e.data))}getTileUrl(e,r,t){const s=!this.tilemapCache&&this.supportsBlankTile,i=n({...this.parsedUrl.query,blankTile:!s&&null,...this.customParameters,token:this.apiKey}),o=this.tileServers;return`${o&&o.length?o[r%o.length]:this.parsedUrl.path}/tile/${e}/${r}/${t}${i?\"?\"+i:\"\"}`}_fetchService(e){return new Promise(((s,o)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");return void s({data:this.sourceJSON})}if(!this.parsedUrl)throw new t(\"tile-layer:undefined-url\",\"layer's url is not defined\");const a=R(this.parsedUrl.path);if(i(a)&&\"ImageServer\"===a.serverType)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");r(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:\"json\",signal:e}).then(s,o)})).then((r=>{if(r.ssl&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=r.data,this.read(r.data,{origin:\"service\",url:this.parsedUrl}),10.1===this.version&&!x(this.url))return this._fetchServerVersion(this.url,e).then((e=>{this.read({currentVersion:e})})).catch((()=>{}))}))}_fetchServerVersion(e,s){if(!U(e))return Promise.reject();const i=e.replace(/(.*\\/rest)\\/.*/i,\"$1\")+\"/info\";return r(i,{query:{f:\"json\",...this.customParameters,token:this.apiKey},responseType:\"json\",signal:s}).then((e=>{if(e.data&&e.data.currentVersion)return e.data.currentVersion;throw new t(\"tile-layer:version-not-available\")}))}_getMapName(e){const r=e.match(/^(?:https?:)?\\/\\/(server\\.arcgisonline\\.com|services\\.arcgisonline\\.com|ibasemaps-api\\.arcgis\\.com)\\/arcgis\\/rest\\/services\\/([^\\/]+(\\/[^\\/]+)*)\\/mapserver/i);return r&&r[2]}_getDefaultAttribution(e){if(!e)return;let r;e=e.toLowerCase();for(let t=0,s=I.length;t<s;t++)if(r=I[t],r.toLowerCase().indexOf(e)>-1)return p(\"//static.arcgis.com/attribution/\"+r)}_getDefaultTileServers(e){const r=-1!==e.search(/^(?:https?:)?\\/\\/server\\.arcgisonline\\.com/i),t=-1!==e.search(/^(?:https?:)?\\/\\/services\\.arcgisonline\\.com/i);return r||t?[e,e.replace(r?/server\\.arcgisonline/i:/services\\.arcgisonline/i,r?\"services.arcgisonline\":\"server.arcgisonline\")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile.__isDefault__}};e([c({readOnly:!0})],M.prototype,\"attributionDataUrl\",null),e([c({type:[\"show\",\"hide\",\"hide-children\"]})],M.prototype,\"listMode\",void 0),e([c({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],M.prototype,\"isReference\",void 0),e([c({readOnly:!0,type:[\"ArcGISTiledMapServiceLayer\"]})],M.prototype,\"operationalLayerType\",void 0),e([c({type:Boolean})],M.prototype,\"resampling\",void 0),e([c()],M.prototype,\"sourceJSON\",void 0),e([c({type:W})],M.prototype,\"spatialReference\",void 0),e([m(\"spatialReference\",[\"spatialReference\",\"tileInfo\"])],M.prototype,\"readSpatialReference\",null),e([c({type:String,json:{origins:{\"web-scene\":{read:!0,write:!0}},read:!1}})],M.prototype,\"path\",void 0),e([c({readOnly:!0})],M.prototype,\"sublayers\",void 0),e([d(\"sublayers\",{layers:{type:[A]}})],M.prototype,\"writeSublayers\",null),e([c({json:{read:!1,write:!1}})],M.prototype,\"popupEnabled\",void 0),e([c()],M.prototype,\"tileServers\",null),e([u(\"tileServers\")],M.prototype,\"castTileServers\",null),e([c({readOnly:!0,json:{read:!1}})],M.prototype,\"type\",void 0),e([c(P)],M.prototype,\"url\",void 0),M=e([h(\"esri.layers.TileLayer\")],M),M.prototype.fetchTile.__isDefault__=!0;var C=M;export default C;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../request.js\";import{constant as i}from\"../../core/arrayUtils.js\";import e from\"../../core/Error.js\";import{clone as a}from\"../../core/lang.js\";class l{constructor(){this.location={left:0,top:0,width:0,height:0},this._allAvailability=\"unknown\",this.byteSize=40}getAvailability(t,i){if(\"unknown\"!==this._allAvailability)return this._allAvailability;const e=(t-this.location.top)*this.location.width+(i-this.location.left),a=e%8,l=e>>3,o=this._tileAvailabilityBitSet;return l<0||l>o.length?\"unknown\":o[l]&1<<a?\"available\":\"unavailable\"}_updateFromData(t){const i=this.location.width,e=this.location.height;let a=!0,l=!0;const o=Math.ceil(i*e/8),n=new Uint8Array(o);let r=0;for(let s=0;s<t.length;s++){const i=s%8;t[s]?(l=!1,n[r]|=1<<i):a=!1,7===i&&++r}l?this._allAvailability=\"unavailable\":a?this._allAvailability=\"available\":(this._allAvailability=\"unknown\",this._tileAvailabilityBitSet=n,this.byteSize+=n.length)}static fromDefinition(a,o){const r=a.service.request||t,{row:s,col:h,width:c,height:m}=a,d={query:{f:\"json\"}};return o=o?{...d,...o}:d,r(n(a),o).then((t=>t.data)).catch((t=>{if(t&&t.details&&422===t.details.httpStatus)return{location:{top:s,left:h,width:c,height:m},valid:!0,data:i(c*m,0)};throw t})).then((t=>{if(t.location&&(t.location.top!==s||t.location.left!==h||t.location.width!==c||t.location.height!==m))throw new e(\"tilemap:location-mismatch\",\"Tilemap response for different location than requested\",{response:t,definition:{top:s,left:h,width:c,height:m}});return l.fromJSON(t)}))}static fromJSON(t){l.validateJSON(t);const i=new l;return i.location=Object.freeze(a(t.location)),i._updateFromData(t.data),Object.freeze(i)}static validateJSON(t){if(!t||!t.location)throw new e(\"tilemap:missing-location\",\"Location missing from tilemap response\");if(!1===t.valid)throw new e(\"tilemap:invalid\",\"Tilemap response was marked as invalid\");if(!t.data)throw new e(\"tilemap:missing-data\",\"Data missing from tilemap response\");if(!Array.isArray(t.data))throw new e(\"tilemap:data-mismatch\",\"Data must be an array of numbers\");if(t.data.length!==t.location.width*t.location.height)throw new e(\"tilemap:data-mismatch\",\"Number of data items does not match width/height of tilemap\")}}function o(t){return`${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}function n(t){let i;if(\"vector-tile\"===t.service.type)i=`${t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;else{const e=t.service.tileServers;i=`${e&&e.length?e[t.row%e.length]:t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}const e=t.service.query;return e&&(i=`${i}?${e}`),i}export default l;export{l as Tilemap,o as tilemapDefinitionId};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../request.js\";import i from\"../../core/Accessor.js\";import l from\"../../core/Error.js\";import r from\"../../core/Handles.js\";import s from\"../../core/Logger.js\";import a from\"../../core/LRUCache.js\";import o from\"../../core/PooledArray.js\";import{onAbort as n,createAbortError as c,isAbortError as h,createAbortController as p,isAborted as m}from\"../../core/promiseUtils.js\";import{waitTicks as u}from\"../../core/scheduling.js\";import{objectToQuery as f}from\"../../core/urlUtils.js\";import{init as v}from\"../../core/watchUtils.js\";import{property as y}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import{cast as _}from\"../../core/accessorSupport/decorators/cast.js\";import{subclass as d}from\"../../core/accessorSupport/decorators/subclass.js\";import{tilemapDefinitionId as b,Tilemap as g}from\"./Tilemap.js\";var w;const T=s.getLogger(\"esri.layers.support.TilemapCache\");let j=w=class extends i{constructor(e){super(e),this._handles=new r,this._pendingTilemapRequests={},this._availableLevels={},this.levels=5,this.cacheByteSize=2097152,this.request=t,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new a(this.cacheByteSize),this._handles.add([this.watch([\"layer.parsedUrl\",\"layer.tileServers?\"],(()=>this._initializeTilemapDefinition())),v(this,\"layer.tileInfo.lods\",(e=>this._initializeAvailableLevels(e)),!0)]),this._initializeTilemapDefinition()}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}castLevels(e){return e<=2?(T.error(\"Minimum levels for Tilemap is 3, but got \",e),3):e}get size(){return 1<<this.levels}fetchTilemap(e,t,i,r){if(!this._availableLevels[e])return Promise.reject(new l(\"tilemap-cache:level-unavailable\",`Level ${e} is unavailable in the service`));const s=this._tmpTilemapDefinition,a=this._tilemapFromCache(e,t,i,s);if(a)return Promise.resolve(a);const o=r&&r.signal;return r={...r,signal:null},new Promise(((e,t)=>{n(o,(()=>t(c())));const i=b(s);let l=this._pendingTilemapRequests[i];if(!l){l=g.fromDefinition(s,r).then((e=>(this._tilemapCache.put(i,e,e.byteSize),e)));const e=()=>delete this._pendingTilemapRequests[i];this._pendingTilemapRequests[i]=l,l.then(e,e)}l.then(e,t)}))}getAvailability(e,t,i){if(!this._availableLevels[e])return\"unavailable\";const l=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return l?l.getAvailability(t,i):\"unknown\"}getAvailabilityUpsample(e,t,i,l){l.level=e,l.row=t,l.col=i;const r=this.layer.tileInfo;for(r.updateTileInfo(l);;){const e=this.getAvailability(l.level,l.row,l.col);if(\"unavailable\"!==e)return e;if(!r.upsampleTile(l))return\"unavailable\"}}fetchAvailability(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch((e=>e)).then((r=>{if(r instanceof g){const s=r.getAvailability(t,i);return\"unavailable\"===s?Promise.reject(new l(\"tile-map:tile-unavailable\",\"Tile is not available\",{level:e,row:t,col:i})):s}if(h(r))throw r;return\"unknown\"})):Promise.reject(new l(\"tilemap-cache:level-unavailable\",`Level ${e} is unavailable in the service`))}fetchAvailabilityUpsample(e,t,i,l,r){l.level=e,l.row=t,l.col=i;const s=this.layer.tileInfo;s.updateTileInfo(l);const a=this.fetchAvailability(e,t,i,r).catch((e=>{if(h(e))throw e;if(s.upsampleTile(l))return this.fetchAvailabilityUpsample(l.level,l.row,l.col,l);throw e}));return this._fetchAvailabilityUpsamplePrefetch(l.id,e,t,i,r,a),a}async _fetchAvailabilityUpsamplePrefetch(e,t,i,l,r,s){if(!this._prefetchingEnabled)return;const a=`prefetch-${e}`;if(this._handles.has(a))return;const o=p();s.then((()=>o.abort()),(()=>o.abort()));let n=!1;const c={remove(){n||(n=!0,o.abort())}};if(this._handles.add(c,a),await u(10,o.signal).catch((()=>{})),n||(n=!0,this._handles.remove(a)),m(o))return;const h={id:e,level:t,row:i,col:l},f={...r,signal:o.signal},v=this.layer.tileInfo;for(let p=0;w._prefetches.length<w._maxPrefetch&&v.upsampleTile(h);++p){const e=this.fetchAvailability(h.level,h.row,h.col,f);w._prefetches.push(e);const t=()=>{w._prefetches.removeUnordered(e)};e.then(t,t)}}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?f(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,i,l){l.level=e,l.row=t-t%this.size,l.col=i-i%this.size;const r=b(l);return this._tilemapCache.get(r)}_initializeAvailableLevels(e){this._availableLevels={},e&&e.forEach((e=>this._availableLevels[e.level]=!0))}get test(){const e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,i,l)=>!!e._tilemapFromCache(t,i,l,e._tmpTilemapDefinition)}}};j._maxPrefetch=4,j._prefetches=new o({initialSize:w._maxPrefetch}),e([y({constructOnly:!0,type:Number})],j.prototype,\"levels\",void 0),e([_(\"levels\")],j.prototype,\"castLevels\",null),e([y({readOnly:!0,type:Number})],j.prototype,\"size\",null),e([y({constructOnly:!0,type:Number})],j.prototype,\"cacheByteSize\",void 0),e([y({constructOnly:!0})],j.prototype,\"layer\",void 0),e([y({constructOnly:!0})],j.prototype,\"request\",void 0),j=w=e([d(\"esri.layers.support.TilemapCache\")],j);export{j as TilemapCache};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"./TileInfo.js\";const r={type:e,json:{origins:{service:{read:{source:[\"tileInfo\",\"minScale\",\"maxScale\",\"minLOD\",\"maxLOD\"],reader:n}}}}};function n(r,n,l,o){if(!r)return null;const{minScale:i,maxScale:t,minLOD:m,maxLOD:s}=n;if(null!=m&&null!=s)return o&&o.ignoreMinMaxLOD?e.fromJSON(r):e.fromJSON({...r,lods:r.lods.filter((({level:e})=>null!=e&&e>=m&&e<=s))});if(0!==i&&0!==t){const n=e=>Math.round(1e4*e)/1e4,l=i?n(i):1/0,o=t?n(t):-1/0;return e.fromJSON({...r,lods:r.lods.filter((e=>{const r=n(e.scale);return r<=l&&r>=o}))})}return e.fromJSON(r)}export{n as readServiceTileInfo,r as serviceTileInfoProperty};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../geometry.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{reader as o}from\"../../core/accessorSupport/decorators/reader.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import{serviceTileInfoProperty as i}from\"../support/serviceTileInfoProperty.js\";import{TilemapCache as p}from\"../support/TilemapCache.js\";import a from\"../../geometry/SpatialReference.js\";const s=s=>{let l=class extends s{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}readMinScale(e,r){return null!=r.minLOD&&null!=r.maxLOD?e:0}readMaxScale(e,r){return null!=r.minLOD&&null!=r.maxLOD?e:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(e,r){return r.capabilities&&r.capabilities.indexOf(\"Tilemap\")>-1?new p({layer:this}):null}};return e([r({json:{read:{source:\"copyrightText\"}}})],l.prototype,\"copyright\",void 0),e([r()],l.prototype,\"minScale\",void 0),e([o(\"service\",\"minScale\")],l.prototype,\"readMinScale\",null),e([r()],l.prototype,\"maxScale\",void 0),e([o(\"service\",\"maxScale\")],l.prototype,\"readMaxScale\",null),e([r({type:a})],l.prototype,\"spatialReference\",void 0),e([r({readOnly:!0})],l.prototype,\"supportsBlankTile\",null),e([r(i)],l.prototype,\"tileInfo\",void 0),e([r()],l.prototype,\"tilemapCache\",void 0),e([o(\"service\",\"tilemapCache\",[\"capabilities\"])],l.prototype,\"readTilemapCache\",null),e([r()],l.prototype,\"version\",void 0),l=e([t(\"esri.layers.mixins.ArcGISCachedService\")],l),l};export{s as ArcGISCachedService};\n"],"sourceRoot":""}