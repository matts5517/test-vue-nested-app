(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-73371494"],{"008c":function(e,t,i){"use strict";i.d(t,"a",(function(){return P})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return k})),i.d(t,"e",(function(){return z})),i.d(t,"f",(function(){return I})),i.d(t,"g",(function(){return j}));var r=i("a9ab");const n=(e,t,i)=>[t,i],o=(e,t,i)=>[t,i,e[2]],a=(e,t,i)=>[t,i,e[2],e[3]];function s(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function c({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function l({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function f(e,t,i){const r=[];let n,o,a,s;for(let f=0;f<i.length;f++){const m=i[f];f>0?(a=c(e,m[0]),s=l(e,m[1]),a===n&&s===o||(r.push(t(m,a-n,s-o)),n=a,o=s)):(n=c(e,m[0]),o=l(e,m[1]),r.push(t(m,n,o)))}return r.length>0?r:null}function m(e,t,i,r){return f(e,i?r?a:o:r?o:n,t)}function h(e,t,i,r){const s=[],c=i?r?a:o:r?o:n;for(let n=0;n<t.length;n++){const i=f(e,c,t[n]);i&&i.length>=3&&s.push(i)}return s.length?s:null}function u(e,t,i,r){const s=[],c=i?r?a:o:r?o:n;for(let n=0;n<t.length;n++){const i=f(e,c,t[n]);i&&i.length>=2&&s.push(i)}return s.length?s:null}function y({scale:e,translate:t},i){return i*e[0]+t[0]}function g({scale:e,translate:t},i){return t[1]-i*e[1]}function d(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[n,o]=e.scale;let a=y(e,i[0][0]),s=g(e,i[0][1]);r[0]=t(i[0],a,s);for(let c=1;c<i.length;c++){const e=i[c];a+=e[0]*n,s-=e[1]*o,r[c]=t(e,a,s)}return r}function p(e,t,i){const r=new Array(i.length);for(let n=0;n<i.length;n++)r[n]=d(e,t,i[n]);return r}function b(e,t,i,r){return d(e,i?r?a:o:r?o:n,t)}function O(e,t,i,r){return p(e,i?r?a:o:r?o:n,t)}function S(e,t,i,r){return p(e,i?r?a:o:r?o:n,t)}function x(e,t,i,r,n){return t.xmin=c(e,i.xmin),t.ymin=l(e,i.ymin),t.xmax=c(e,i.xmax),t.ymax=l(e,i.ymax),t!==i&&(r&&(t.zmin=i.zmin,t.zmax=i.zmax),n&&(t.mmin=i.mmin,t.mmax=i.mmax)),t}function C(e,t,i,r,n){return t.points=m(e,i.points,r,n),t}function v(e,t,i,r,n){return t.x=c(e,i.x),t.y=l(e,i.y),t!==i&&(r&&(t.z=i.z),n&&(t.m=i.m)),t}function M(e,t,i,r,n){const o=h(e,i.rings,r,n);return o?(t.rings=o,t):null}function w(e,t,i,r,n){const o=u(e,i.paths,r,n);return o?(t.paths=o,t):null}function P(e,t){return e&&t?Object(r["f"])(t)?v(e,{},t,!1,!1):Object(r["h"])(t)?w(e,{},t,!1,!1):Object(r["g"])(t)?M(e,{},t,!1,!1):Object(r["e"])(t)?C(e,{},t,!1,!1):Object(r["d"])(t)?x(e,{},t,!1,!1):null:null}function k(e,t,i,r,n){return t.points=b(e,i.points,r,n),t}function z(e,t,i,r,n){return t.x=y(e,i.x),t.y=g(e,i.y),t!==i&&(r&&(t.z=i.z),n&&(t.m=i.m)),t}function I(e,t,i,r,n){return t.rings=S(e,i.rings,r,n),t}function j(e,t,i,r,n){return t.paths=O(e,i.paths,r,n),t}},"405c":function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return m}));var r=i("a9ab"),n=i("5f8c"),o=i("0eee");function a(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":{const t=e.symbolLayers;return t&&1===t.length?a(t[0]):null}case"CIMVectorMarker":{const t=e.markerGraphics;if(!t||1!==t.length)return null;const i=t[0];if(!i)return null;const r=i.geometry;if(!r)return null;const n=i.symbol;return!n||"CIMPolygonSymbol"!==n.type&&"CIMLineSymbol"!==n.type?null:{geom:r,asFill:"CIMPolygonSymbol"===n.type}}case"sdf":return{geom:e.geom,asFill:e.asFill}}return null}function s(e){return e?e.rings?e.rings:e.paths?e.paths:void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null}function c(e){let t=1/0,i=-1/0,r=1/0,n=-1/0;for(const o of e)for(const e of o)e[0]<t&&(t=e[0]),e[0]>i&&(i=e[0]),e[1]<r&&(r=e[1]),e[1]>n&&(n=e[1]);return new o["a"](t,r,i-t,n-r)}function l(e){let t=1/0,i=-1/0,r=1/0,n=-1/0;for(const o of e)for(const e of o)e[0]<t&&(t=e[0]),e[0]>i&&(i=e[0]),e[1]<r&&(r=e[1]),e[1]>n&&(n=e[1]);return[t,r,i,n]}function f(e){return e?e.rings?l(e.rings):e.paths?l(e.paths):Object(r["d"])(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}function m(e,t,i,r,n){const[o,a,s,c]=e;if(s<o||c<a)return[0,0,0];const l=s-o,f=c-a,m=128,h=1,u=Math.floor(.5*(.5*m-h)),y=(m-2*(u+h))/Math.max(l,f),g=Math.round(l*y)+2*u,d=Math.round(f*y)+2*u;let p=1;t&&(p=d/y/(t.ymax-t.ymin));let b=0,O=0;if(r)if(n){if(t&&i&&t.ymax-t.ymin>0){const e=(t.xmax-t.xmin)/(t.ymax-t.ymin);b=r.x/(i*e),O=r.y/i}}else b=r.x,O=r.y;return b=.5*(t.xmax+t.xmin)+b*(t.xmax-t.xmin),O=.5*(t.ymax+t.ymin)+O*(t.ymax-t.ymin),b-=o,O-=a,b*=y,O*=y,b+=u,O+=u,[p,b/g-.5,-(O/d-.5)]}function h(e){const t=s(e.geom),i=c(t),r=128,n=1,o=Math.floor(.5*(.5*r-n)),a=(r-2*(o+n))/Math.max(i.width,i.height),l=Math.round(i.width*a)+2*o,f=Math.round(i.height*a)+2*o,m=[];for(const s of t)if(s&&s.length>1){const t=[];for(const e of s){let[r,n]=e;r-=i.x,n-=i.y,r*=a,n*=a,r+=o-.5,n+=o-.5,t.push([r,n])}if(e.asFill){const e=t.length-1;t[0][0]===t[e][0]&&t[0][1]===t[e][1]||t.push(t[0])}m.push(t)}const h=u(m,l,f,o);return e.asFill&&y(m,l,f,o,h),[g(h,o),l,f]}function u(e,t,i,r){const n=t*i,o=new Array(n),a=r*r+1;for(let s=0;s<n;++s)o[s]=a;for(const s of e){const e=s.length;for(let n=1;n<e;++n){const e=s[n-1],a=s[n];let c,l,f,m;e[0]<a[0]?(c=e[0],l=a[0]):(c=a[0],l=e[0]),e[1]<a[1]?(f=e[1],m=a[1]):(f=a[1],m=e[1]);let h=Math.floor(c)-r,u=Math.floor(l)+r,y=Math.floor(f)-r,g=Math.floor(m)+r;h<0&&(h=0),u>t&&(u=t),y<0&&(y=0),g>i&&(g=i);const d=a[0]-e[0],p=a[1]-e[1],b=d*d+p*p;for(let r=h;r<u;r++)for(let n=y;n<g;n++){let s,c,l=(r-e[0])*d+(n-e[1])*p;l<0?(s=e[0],c=e[1]):l>b?(s=a[0],c=a[1]):(l/=b,s=e[0]+l*d,c=e[1]+l*p);const f=(r-s)*(r-s)+(n-c)*(n-c),m=(i-n-1)*t+r;f<o[m]&&(o[m]=f)}}}for(let s=0;s<n;++s)o[s]=Math.sqrt(o[s]);return o}function y(e,t,i,r,n){for(const o of e){const e=o.length;for(let a=1;a<e;++a){const e=o[a-1],s=o[a];let c,l,f,m;e[0]<s[0]?(c=e[0],l=s[0]):(c=s[0],l=e[0]),e[1]<s[1]?(f=e[1],m=s[1]):(f=s[1],m=e[1]);let h=Math.floor(c),u=Math.floor(l)+1,y=Math.floor(f),g=Math.floor(m)+1;h<r&&(h=r),u>t-r&&(u=t-r),y<r&&(y=r),g>i-r&&(g=i-r);for(let o=y;o<g;++o){if(e[1]>o==s[1]>o)continue;const a=(i-o-1)*t;for(let t=h;t<u;++t)t<(s[0]-e[0])*(o-e[1])/(s[1]-e[1])+e[0]&&(n[a+t]=-n[a+t]);for(let e=r;e<h;++e)n[a+e]=-n[a+e]}}}}function g(e,t){const i=2*t,r=e.length,o=new Uint8Array(4*r);for(let a=0;a<r;++a){const t=.5-e[a]/i;Object(n["a"])(t,o,4*a)}return o}},"4fcb":function(e,t,i){"use strict";i.d(t,"a",(function(){return J})),i.d(t,"b",(function(){return x}));var r=i("9ef0"),n=i("e92d"),o=i("a915"),a=i("b3b6"),s=i("82fa"),c=i("793f"),l=i("405c"),f=i("36b8"),m=i("89cb");const h=n["a"].getLogger("esri.symbols.cim.cimAnalyzer");function u(e){switch(e){case"Butt":return 0;case"Square":return 2;case"Round":default:return 1}}function y(e){switch(e){case"Bevel":return 0;case"Miter":return 2;case"Round":default:return 1}}function g(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function d(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function p(e){let t="normal",i="normal";if(e){const r=e.toLowerCase();-1!==r.indexOf("italic")?t="italic":-1!==r.indexOf("oblique")&&(t="oblique"),-1!==r.indexOf("bold")?i="bold":-1!==r.indexOf("light")&&(i="lighter")}return{style:t,weight:i}}function b(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function O(e,t,i,r){let n;e[t]?n=e[t]:(n={},e[t]=n),n[i]=r}function S(e){const t=e.markerPlacement;return t&&t.angleToLine?1:0}async function x(e,t,i,r){const n=null!=i?i:[];if(!e)return n;let o,a;const c={};if("CIMSymbolReference"!==e.type)return h.error("Expect cim type to be 'CIMSymbolReference'"),n;if(o=e.symbol,a=e.primitiveOverrides,a){const e=[];for(const i of a){const r=i.valueExpressionInfo;if(r&&t){const n=r.expression,o=Object(s["d"])(n,t.spatialReference,t.fields).then(e=>{e&&O(c,i.primitiveName,i.propertyName,e)});e.push(o)}else null!=i.value&&O(c,i.primitiveName,i.propertyName,i.value)}await Promise.all(e)}switch(o.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":C(o,a,c,t,n,r)}return n}function C(e,t,i,r,n,o){if(!e)return;const a=e.symbolLayers;if(!a)return;let s;const l=c["a"].getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(s=1);let f=a.length;for(;f--;){const m=a[f];if(!m||!1===m.enable)continue;const u=[];switch(c["b"].findApplicableOverrides(m,t,u),m.type){case"CIMSolidFill":v(m,i,u,r,n);break;case"CIMPictureFill":M(m,i,u,r,n);break;case"CIMHatchFill":w(m,i,u,r,n);break;case"CIMGradientFill":P(m,i,u,r,n);break;case"CIMSolidStroke":k(m,i,u,r,n,"CIMPolygonSymbol"===e.type,l);break;case"CIMPictureStroke":z(m,i,u,r,n,"CIMPolygonSymbol"===e.type,l);break;case"CIMGradientStroke":I(m,i,u,r,n,"CIMPolygonSymbol"===e.type,l);break;case"CIMCharacterMarker":if(j(m,i,u,r,n))break;break;case"CIMPictureMarker":if(j(m,i,u,r,n))break;"CIMLineSymbol"===e.type&&(s=S(m)),N(m,i,u,r,n,s,l);break;case"CIMVectorMarker":if(j(m,i,u,r,n))break;"CIMLineSymbol"===e.type&&(s=S(m)),L(m,i,u,r,n,s,l,o);break;default:h.error("Cannot analyze CIM layer",m.type)}}}function v(e,t,i,r,n){const o=e.primitiveName,s=Object(f["e"])(e.color),[c,l]=T(i,o),m=Object(a["b"])(JSON.stringify(e)+l).toString();n.push({type:"fill",templateHash:m,materialHash:c?()=>m:m,cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:F(o,t,"Color",r,s,Y),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:e.effects})}function M(e,t,i,r,n){const o=e.primitiveName,s=e.tintColor?Object(f["e"])(e.tintColor):{r:255,g:255,b:255,a:1},[c,l]=T(i,o),m=Object(a["b"])(JSON.stringify(e)+l).toString(),h=Object(a["b"])(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString();n.push({type:"fill",templateHash:m,materialHash:c?()=>h:h,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:F(o,t,"TintColor",r,s,Y),height:F(o,t,"Height",r,e.height),scaleX:F(o,t,"ScaleX",r,e.scaleX),angle:F(o,t,"Rotation",r,e.rotation),offsetX:F(o,t,"OffsetX",r,e.offsetX),offsetY:F(o,t,"OffsetY",r,e.offsetY)})}function w(e,t,i,r,n){const o=["Rotation","OffsetX","OffsetY"],s=i.filter(t=>t.primitiveName!==e.primitiveName&&-1===o.indexOf(t.propertyName)),c=e.primitiveName,[l,f]=T(i,c),m=Object(a["b"])(JSON.stringify(e)+f).toString(),h=Object(a["b"])(`${e.separation}${JSON.stringify(e.lineSymbol)}`).toString();n.push({type:"fill",templateHash:m,materialHash:l?D(h,t,s,r):h,cim:e,materialOverrides:s,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:F(c,t,"Separation",r,e.separation),scaleX:1,angle:F(c,t,"Rotation",r,e.rotation),offsetX:F(c,t,"OffsetX",r,e.offsetX),offsetY:F(c,t,"OffsetY",r,e.offsetY)})}function P(e,t,i,r,n){const o=e.primitiveName,[s,c]=T(i,o),l=Object(a["b"])(JSON.stringify(e)+c).toString();n.push({type:"fill",templateHash:l,materialHash:s?D(l,t,i,r):l,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function k(e,t,i,r,n,o,s){const c=e.primitiveName,l=Object(f["e"])(e.color),m=void 0!==e.width?e.width:4,h=u(e.capStyle),g=y(e.joinStyle),d=e.miterLimit,[p,b]=T(i,c),O=Object(a["b"])(JSON.stringify(e)+b).toString();n.push({type:"line",templateHash:O,materialHash:p?()=>O:O,cim:e,materialOverrides:null,isOutline:o,colorLocked:e.colorLocked,effects:e.effects,color:F(c,t,"Color",r,l,Y),width:F(c,t,"Width",r,m),cap:F(c,t,"CapStyle",r,h),join:F(c,t,"JoinStyle",r,g),miterLimit:F(c,t,"MiterLimit",r,d),referenceWidth:s,zOrder:A(e.name),isDashed:!1})}function z(e,t,i,r,n,o,s){const c=Object(a["b"])(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),l=e.primitiveName,m=Object(f["e"])(e.tintColor),h=void 0!==e.width?e.width:4,g=u(e.capStyle),d=y(e.joinStyle),p=e.miterLimit,[b,O]=T(i,l),S=Object(a["b"])(JSON.stringify(e)+O).toString();n.push({type:"line",templateHash:S,materialHash:b?()=>c:c,cim:e,materialOverrides:null,isOutline:o,colorLocked:e.colorLocked,effects:e.effects,color:F(l,t,"TintColor",r,m,Y),width:F(l,t,"Width",r,h),cap:F(l,t,"CapStyle",r,g),join:F(l,t,"JoinStyle",r,d),miterLimit:F(l,t,"MiterLimit",r,p),referenceWidth:s,zOrder:A(e.name),isDashed:!1})}function I(e,t,i,r,n,o,s){const c=e.primitiveName,l=void 0!==e.width?e.width:4,f=u(e.capStyle),m=y(e.joinStyle),h=e.miterLimit,[g,d]=T(i,c),p=Object(a["b"])(JSON.stringify(e)+d).toString();n.push({type:"line",templateHash:p,materialHash:g?D(p,t,i,r):p,cim:e,materialOverrides:null,isOutline:o,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},width:F(c,t,"Width",r,l),cap:F(c,t,"CapStyle",r,f),join:F(c,t,"JoinStyle",r,m),miterLimit:F(c,t,"MiterLimit",r,h),referenceWidth:s,zOrder:A(e.name),isDashed:!1})}function j(e,t,i,r,n){const o=e.markerPlacement;if(!o||"CIMMarkerPlacementInsidePolygon"!==o.type)return!1;const s=o,c=["Rotation","OffsetX","OffsetY"],l=i.filter(t=>t.primitiveName!==e.primitiveName&&-1===c.indexOf(t.propertyName)),[f,m]=T(i,s.primitiveName),h=Object(a["b"])(JSON.stringify(e)+m).toString();return n.push({type:"fill",templateHash:h,materialHash:f?D(h,t,l,r):h,cim:e,materialOverrides:l,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:F(s.primitiveName,t,"StepY",r,s.stepY),scaleX:1,angle:F(s.primitiveName,t,"GridAngle",r,s.gridAngle),offsetX:F(s.primitiveName,t,"OffsetX",r,s.offsetX),offsetY:F(s.primitiveName,t,"OffsetY",r,s.offsetY)}),!0}function N(e,t,i,r,n,o,s){const c=e.primitiveName,l=e.size,m=e.scaleX,h=e.rotation,u=e.offsetX,y=e.offsetY,g=Object(f["e"])(e.tintColor),d=Object(a["b"])(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),[p,b]=T(i,c),O=Object(a["b"])(JSON.stringify(e)+b).toString();n.push({type:"marker",templateHash:O,materialHash:p?()=>d:d,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:!1,alignment:o,size:F(c,t,"Size",r,l),scaleX:F(c,t,"ScaleX",r,m),rotation:F(c,t,"Rotation",r,h),offsetX:F(c,t,"OffsetX",r,u),offsetY:F(c,t,"OffsetY",r,y),color:F(c,t,"TintColor",r,g,Y),anchorPoint:e.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:s,sizeRatio:1,markerPlacement:e.markerPlacement})}function L(e,t,i,r,n,o,a,s){const c=e.markerGraphics;if(!c)return;let l=0;if(e.scaleSymbolsProportionally){const t=e.frame;t&&(l=t.ymax-t.ymin)}for(const f of c)if(f){const c=f.symbol;if(!c)continue;switch(c.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":_(e,f,i,t,r,n,o,a,l,s);break;case"CIMTextSymbol":R(e,f,t,i,r,n,o,a,l)}}}function R(e,t,i,r,n,o,s,l,m){const h=[];c["b"].findApplicableOverrides(t,r,h);const u=t.geometry;if(!("x"in u)||!("y"in u))return;const y=t.symbol,O=b(y),S=p(y.fontStyleName);y.font={family:y.fontFamilyName,decoration:O,...S};const x=e.frame,C=u.x-.5*(x.xmin+x.xmax),v=u.y-.5*(x.ymin+x.ymax),M=e.size/m,w=e.primitiveName,P=(y.height||0)*M,k=y.angle||0,z=((y.offsetX||0)+C)*M,I=((y.offsetY||0)+v)*M,j=Object(f["e"])(c["a"].getFillColor(y));let N=Object(f["e"])(c["a"].getStrokeColor(y)),L=c["a"].getStrokeWidth(y);L||(N=Object(f["e"])(c["a"].getFillColor(y.haloSymbol)),L=y.haloSize*M);let R="";for(const a of r)a.primitiveName===w&&void 0!==a.value&&(R+=`-${a.primitiveName}-${a.propertyName}-${JSON.stringify(a.value)}`);const _=JSON.stringify(e.effects)+Number(e.colorLocked)+JSON.stringify(e.anchorPoint)+e.anchorPointUnits+JSON.stringify(e.markerPlacement),H=Object(a["b"])(JSON.stringify(t)+_+R).toString();o.push({type:"text",templateHash:H,materialHash:()=>Object(a["b"])(JSON.stringify(y.font)).toString(),cim:y,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,alignment:s,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:y.fontFamilyName,decoration:"none",weight:"normal",style:"normal",size:F(w,i,"Size",n,P),angle:F(w,i,"Rotation",n,k),offsetX:F(w,i,"OffsetX",n,z),offsetY:F(w,i,"OffsetY",n,I),horizontalAlignment:g(y.horizontalAlignment),verticalAlignment:d(y.verticalAlignment),text:F(t.primitiveName,i,"TextString",n,t.textString,f["a"],y.textCase),color:j,outlineColor:N,outlineSize:L,referenceSize:l,sizeRatio:1,markerPlacement:e.markerPlacement})}function _(e,t,i,r,n,o,s,m,h,u){const y=t.symbol,g=t.geometry;if(!g)return;const d=y.symbolLayers;if(!d)return;if(u)return void H(e,t,r,i,n,o,s,m,h);let p=d.length;for(;p--;){const u=d[p];if(u&&!1!==u.enable)switch(u.type){case"CIMSolidFill":case"CIMSolidStroke":{const y=Object(l["b"])(g);if(!y)continue;const[d,p,b]=Object(l["d"])(y,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),O="CIMSolidFill"===u.type,S={type:"sdf",geom:g,asFill:O},x=e.primitiveName,C=e.size,v=e.rotation||0,M=e.offsetX,w=e.offsetY,P=u.primitiveName,k=Object(f["e"])(O?c["a"].getFillColor(u):c["a"].getStrokeColor(u)),z=O?{r:0,g:0,b:0,a:0}:Object(f["e"])(c["a"].getStrokeColor(u)),I=c["a"].getStrokeWidth(u);if(!O&&!I)break;let j=!1,N="";for(const e of i)e.primitiveName!==P&&e.primitiveName!==x||(void 0!==e.value?N+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(j=!0));const L=JSON.stringify({...e,markerGraphics:null}),R=Object(a["b"])(JSON.stringify(S)).toString(),_={type:"marker",templateHash:Object(a["b"])(JSON.stringify(t)+JSON.stringify(u)+L+N).toString(),materialHash:j?()=>R:R,cim:S,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:p,y:b},isAbsoluteAnchorPoint:!1,size:F(e.primitiveName,r,"Size",n,C),rotation:F(e.primitiveName,r,"Rotation",n,v),offsetX:F(e.primitiveName,r,"OffsetX",n,M),offsetY:F(e.primitiveName,r,"OffsetY",n,w),scaleX:1,frameHeight:h,rotateClockwise:e.rotateClockwise,referenceSize:m,sizeRatio:d,color:F(P,r,"Color",n,k,Y),outlineColor:F(P,r,"Color",n,z,Y),outlineWidth:F(P,r,"Width",n,I),markerPlacement:e.markerPlacement};o.push(_);break}default:H(e,t,r,i,n,o,s,m,h)}}}function H(e,t,i,r,n,s,l,f,m){const h=X(e,t);let u=[];const y=["Rotation","OffsetX","OffsetY"];u=r.filter(t=>t.primitiveName!==e.primitiveName||-1===y.indexOf(t.propertyName));let g="";for(const o of r)void 0!==o.value&&(g+=`-${o.primitiveName}-${o.propertyName}-${JSON.stringify(o.value)}`);const[d,p,b]=c["a"].getTextureAnchor(h),O=e.primitiveName,S=e.rotation||0,x=e.offsetX||0,C=e.offsetY||0,v=Object(a["b"])(JSON.stringify(h)+g).toString(),M={type:"marker",templateHash:v,materialHash:0===u.length?v:D(v,i,u,n),cim:h,materialOverrides:u,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:l,anchorPoint:{x:d,y:p},isAbsoluteAnchorPoint:!1,size:e.size,rotation:F(O,i,"Rotation",n,S),offsetX:F(O,i,"OffsetX",n,x),offsetY:F(O,i,"OffsetY",n,C),color:{r:0,g:0,b:0,a:0},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:m,rotateClockwise:e.rotateClockwise,referenceSize:f,sizeRatio:b/Object(o["c"])(e.size),markerPlacement:e.markerPlacement};s.push(M)}function X(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath,effects:e.effects}}function A(e){if(e&&0===e.indexOf("Level_")){const t=parseInt(e.substr(6),10);if(NaN!==t)return t}return 0}function Y(e){if(!e||0===e.length)return null;const t=new r["a"](e).toRgba();return{r:t[0],g:t[1],b:t[2],a:t[3]}}function F(e,t,i,r,n,o,a){const c=t[e];if(c){const e=c[i];if("string"==typeof e||"number"==typeof e||e instanceof Array)return o?o.call(null,e,a):e;if(null!=e&&e instanceof s["a"])return(t,i,s)=>{let c=Object(m["a"])(e,t,{$view:s},r.geometryType,i);return null!==c&&o&&(c=o.call(null,c,a)),null!==c?c:n}}return n}function D(e,t,i,r){for(const n of i)if(n.valueExpressionInfo){const e=t[n.primitiveName]&&t[n.primitiveName][n.propertyName];e instanceof s["a"]&&(n.fn=(t,i,n)=>Object(m["a"])(e,t,{$view:n},r.geometryType,i))}return(t,r,n)=>{for(const e of i)e.fn&&(e.value=e.fn(t,r,n));return Object(a["b"])(e+c["b"].buildOverrideKey(i)).toString()}}function J(e,t){if(!t||0===t.length)return e;const i=JSON.parse(JSON.stringify(e));return c["b"].applyOverrides(i,t),i}function T(e,t){let i=!1,r="";for(const n of e)n.primitiveName===t&&(void 0!==n.value?r+=`-${n.primitiveName}-${n.propertyName}-${JSON.stringify(n.value)}`:n.valueExpressionInfo&&(i=!0));return[i,r]}},"7b82":function(e,t,i){"use strict";var r=i("793f"),n=i("0eee"),o=i("405c"),a=i("36b8");const s=512;class c{dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(e,t,i){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===e.type||"esriSFS"===e.type){const[i,n,o]=r["c"].rasterizeSimpleFill(this._rasterizationCanvas,e.style,t);return{size:[n,o],image:new Uint32Array(i.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===e.type||"esriSLS"===e.type){const[t,i,n]=r["c"].rasterizeSimpleLine(e.style,e.cap);return{size:[i,n],image:new Uint32Array(t.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let a,s,c;if("simple-marker"===e.type||"esriSMS"===e.type||"line-marker"===e.type?(a=r["a"].fromSimpleMarker(e),c=Object(o["c"])(a)):"CIMHatchFill"===e.type?(a=r["a"].fromCIMHatchFill(e),s=new n["a"](a.frame.xmin,-a.frame.ymax,a.frame.xmax-a.frame.xmin,a.frame.ymax-a.frame.ymin)):e.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type?(a=r["a"].fromCIMInsidePolygon(e),s=new n["a"](a.frame.xmin,-a.frame.ymax,a.frame.xmax-a.frame.xmin,a.frame.ymax-a.frame.ymin)):(a=e,c=Object(o["c"])(a)),c&&!i){const[e,t,i]=Object(o["a"])(c);return e?{size:[t,i],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[l,f,m,h,u]=r["a"].rasterize(this._rasterizationCanvas,a,s,!i);return l?{size:[f,m],image:new Uint32Array(l.buffer),sdf:!1,simplePattern:!1,anchorX:h,anchorY:u}:null}rasterizeImageResource(e,t,i,r){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=e,this._rasterizationCanvas.height=t;const n=this._rasterizationCanvas.getContext("2d");i instanceof ImageData?n.putImageData(i,0,0):(i.setAttribute("width",e+"px"),i.setAttribute("height",t+"px"),n.drawImage(i,0,0,e,t));const o=n.getImageData(0,0,e,t),c=new Uint8Array(o.data);if(r)for(const a of r)if(a&&a.oldColor&&4===a.oldColor.length&&a.newColor&&4===a.newColor.length){const[e,t,i,r]=a.oldColor,[n,o,s,l]=a.newColor;if(e===n&&t===o&&i===s&&r===l)continue;for(let a=0;a<c.length;a+=4)e===c[a]&&t===c[a+1]&&i===c[a+2]&&r===c[a+3]&&(c[a]=n,c[a+1]=o,c[a+2]=s,c[a+3]=l)}let l;for(let a=0;a<c.length;a+=4)l=c[a+3]/255,c[a]=c[a]*l,c[a+1]=c[a+1]*l,c[a+2]=c[a+2]*l;let f=c,m=e,h=t;const u=s;if(m>=u||h>=u){const i=m/h;i>1?(m=u,h=Math.round(u/i)):(h=u,m=Math.round(u*i)),f=new Uint8Array(4*m*h);const r=new Uint8ClampedArray(f.buffer);Object(a["j"])(c,e,t,r,m,h,!1)}return{size:[m,h],image:new Uint32Array(f.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}t["a"]=c},"89cb":function(e,t,i){"use strict";var r=i("ce50"),n=i("e92d"),o=i("008c");function a(e,t,i,r,o){const a=e.referencesGeometry()&&o?c(t,r,o):t,s=e.repurposeFeature(a);try{return e.evaluate({...i,$feature:s})}catch(l){return n["a"].getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",l),null}}const s=new Map;function c(e,t,i){const{transform:r,hasZ:n,hasM:o}=i;s.has(t)||s.set(t,l(t));const a=s.get(t)(e.geometry,r,n,o);return{...e,geometry:a}}function l(e){const t={};switch(e){case"esriGeometryPoint":return(e,i,r,n)=>Object(o["e"])(i,t,e,r,n);case"esriGeometryPolygon":return(e,i,r,n)=>Object(o["f"])(i,t,e,r,n);case"esriGeometryPolyline":return(e,i,r,n)=>Object(o["g"])(i,t,e,r,n);case"esriGeometryMultipoint":return(e,i,r,n)=>Object(o["d"])(i,t,e,r,n);default:return n["a"].getLogger("esri.views.2d.support.arcadeOnDemand").error(new r["a"]("mapview-arcade","Unable to handle geometryType: "+e)),e=>e}}t["a"]=a},fcb9:function(e,t,i){"use strict";i.r(t),i.d(t,"previewCIMSymbol",(function(){return k}));var r=i("a915"),n=i("2eab"),o=i("f4cc"),a=i("b3b6"),s=i("a9ab"),c=i("4fcb"),l=i("7b82");function f(e){return`rgb(${e.slice(0,3).toString()})`}function m(e){return`rgba(${e.slice(0,3).toString()},${e[3]})`}class h{constructor(){}rasterizeText(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,r=i.getContext("2d");this.setFontProperties(r,t),this.parameters=t,this.textLines=e.split(/\r?\n/),this.lineHeight=this.computeLineHeight();const n=this.computeTextWidth(r,t),o=this.lineHeight*this.textLines.length;i.width=n,i.height=o,this.renderedLineHeight=Math.round(this.lineHeight*t.pixelRatio),this.renderedHaloSize=t.halo.size*t.pixelRatio,this.renderedWidth=n*t.pixelRatio,this.renderedHeight=o*t.pixelRatio,this.fillStyle=m(t.color),this.haloStyle=f(t.halo.color);const a=this.renderedLineHeight,s=this.renderedHaloSize;this.setFontProperties(r,t);const c=u(r.textAlign,this.renderedWidth)+s,l=s;let h=0,y=0;s>0&&this.renderHalo(r,c,l,h,y,t),y+=l,h+=c;for(const f of this.textLines)r.globalCompositeOperation="destination-out",r.fillStyle="rgb(0, 0, 0)",r.fillText(f,h,y),r.globalCompositeOperation="source-over",r.fillStyle=this.fillStyle,r.fillText(f,h,y),y+=a;const g=r.getImageData(0,0,this.renderedWidth,this.renderedHeight),d=new Uint8Array(g.data);if(t.premultiplyColors){let e;for(let t=0;t<d.length;t+=4)e=d[t+3]/255,d[t]=d[t]*e,d[t+1]=d[t+1]*e,d[t+2]=d[t+2]*e}return{size:[this.renderedWidth,this.renderedHeight],image:new Uint32Array(d.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}renderHalo(e,t,i,r,n,o){const a=this.renderedWidth,s=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=a,this._haloRasterizationCanvas.height=s;const c=this._haloRasterizationCanvas,l=c.getContext("2d");l.clearRect(0,0,a,s),this.setFontProperties(l,o),l.fillStyle=this.haloStyle,l.strokeStyle=this.haloStyle;const f=this.renderedHaloSize<3;l.lineJoin=f?"miter":"round",f?this.renderHaloEmulated(l,t,i):this.renderHaloNative(l,t,i),e.globalAlpha=this.parameters.halo.color[3],e.drawImage(c,0,0,a,s,r,n,a,s),e.globalAlpha=1}renderHaloEmulated(e,t,i){const r=this.renderedLineHeight,n=this.renderedHaloSize;for(const o of this.textLines){for(const[r,a]of y)e.fillText(o,t+n*r,i+n*a);i+=r}}renderHaloNative(e,t,i){const r=this.renderedLineHeight,n=this.renderedHaloSize;for(const o of this.textLines){const a=2*n,s=5,c=.1;for(let r=0;r<s;r++){const n=1-(s-1)*c+r*c;e.lineWidth=n*a,e.strokeText(o,t,i)}i+=r}}setFontProperties(e,t){const i=t.font,n=`${i.style} ${i.weight} ${Object(r["c"])(t.size*t.pixelRatio)}px ${i.family}, sans-serif`;let o;switch(e.font=n,e.textBaseline="top",t.horizontalAlignment){case"left":o="left";break;case"right":o="right";break;case"center":o="center";break;default:o="left"}e.textAlign=o}computeTextWidth(e,t){let i=0;for(const n of this.textLines)i=Math.max(i,e.measureText(n).width);const r=t.font;return("italic"===r.style||"oblique"===r.style||"string"==typeof r.weight&&("bold"===r.weight||"bolder"===r.weight)||"number"==typeof r.weight&&r.weight>600)&&(i+=.3*e.measureText("A").width),i+=2*this.parameters.halo.size,Math.round(i)}computeLineHeight(){const e=1.275*this.parameters.size;return Math.round(e+2*this.parameters.halo.size)}}function u(e,t){return"center"===e?.5*t:"right"===e?t:0}const y=[];{const e=16;for(let t=0;t<360;t+=360/e)y.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}var g,d=i("36b8"),p=i("d445"),b=i("485a");!function(e){e.Legend="legend",e.Preview="preview"}(g||(g={}));const O=(e,t,i)=>{if(e&&e.targetSize){let n;if(i){const t=Math.max(i.frame.xmax-i.frame.xmin,i.frame.ymax-i.frame.ymin);n=e.targetSize/Object(r["c"])(t)}else n=e.targetSize/t.referenceSize;return n}return e&&e.scaleFactor?e.scaleFactor:1},S={fill:{legend:{frame:{xmax:15,xmin:0,ymax:15,ymin:0},geometry:{rings:[[[0,15],[15,7.5],[15,0],[0,0],[0,15]]]},canvasPaths:{rings:[[[0,15],[0,0],[15,7.5],[15,15],[0,15]]]}},preview:{frame:{xmax:100,xmin:0,ymax:100,ymin:0},geometry:{rings:[[[0,100],[100,100],[100,0],[0,0],[0,100]]]},canvasPaths:{rings:[[[0,100],[0,0],[100,0],[100,100],[0,100]]]}}},stroke:{legend:{frame:{xmax:24,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[12,0],[24,0]]]},canvasPaths:{paths:[[[0,2],[12,2],[24,2]]]}},preview:{frame:{xmax:100,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[50,0],[100,0]]]},canvasPaths:{paths:[[[0,2],[50,2],[100,2]]]}}}};class x{constructor(e,t){this._spatialReference=e,this._avoidSDF=t,this._resourceCache=new Map,this._rasterizer=new l["a"],this._textRasterizer=new h,this._pictureMarkerCache=new Map}async rasterizeCIMSymbolAsync(e,t,i,r,n,o,a,c){r=r||(t?null!=t.centroid?"esriGeometryPolygon":Object(s["c"])(t.geometry):null)||v(e);const l=await this.analyzeCIMSymbol(e,t?C(t.attributes):null,i,r,c);return this.rasterizeCIMSymbol(l,t,r,n,o,a)}async analyzeCIMSymbol(e,t,i,r,n){const a=[],s=t?{geometryType:r,spatialReference:this._spatialReference,fields:t}:null;let l;await Object(c["b"])(e.data,s,a,this._avoidSDF),Object(o["v"])(n);for(const o of a)"CIMPictureMarker"!==o.cim.type&&"CIMPictureFill"!==o.cim.type&&"CIMPictureStroke"!==o.cim.type||(l||(l=[]),l.push(this.fetchPictureMarkerResource(o,n))),i&&"text"===o.type&&"string"==typeof o.text&&o.text.indexOf("[")>-1&&(o.text=Object(d["c"])(i,o.text,o.cim.textCase));return l&&await Promise.all(l),a}async fetchPictureMarkerResource(e,t){const i=e.materialHash;if(!this._pictureMarkerCache.get(i)){const r=(await Object(n["default"])(e.cim.url,{responseType:"image",signal:t&&t.signal})).data;this._pictureMarkerCache.set(i,r)}}rasterizeCIMSymbol(e,t,i,r,n,o){const a=[];for(const s of e){r&&"function"==typeof r.scaleFactor&&(r.scaleFactor=r.scaleFactor(t,n,o));const e=this._getRasterizedResource(s,t,i,r,n,o);if(!e)continue;let c=0,l=e.anchorX||0,f=e.anchorY||0,m=!1,h=0,u=0;if("esriGeometryPoint"===i){const e=O(r,s,null);if(h=Object(d["d"])(s.offsetX,t,n,o)*e||0,u=Object(d["d"])(s.offsetY,t,n,o)*e||0,"marker"===s.type)c=Object(d["d"])(s.rotation,t,n,o)||0,m=!!s.rotateClockwise&&s.rotateClockwise;else if("text"===s.type){if(c=Object(d["d"])(s.angle,t,n,o)||0,void 0!==s.horizontalAlignment)switch(s.horizontalAlignment){case"left":l=-.5;break;case"right":l=.5;break;default:l=0}if(void 0!==s.verticalAlignment)switch(s.verticalAlignment){case"top":f=.5;break;case"bottom":f=-.5;break;case"baseline":f=-.25;break;default:f=0}}}null!=e&&a.push({angle:c,rotateClockWise:m,anchorX:l,anchorY:f,offsetX:h,offsetY:u,rasterizedResource:e})}return this.getSymbolImage(a)}getSymbolImage(e){const t=document.createElement("canvas"),i=t.getContext("2d");let n=0,o=0,a=0,s=0;const c=[];for(let h=0;h<e.length;h++){const t=e[h],l=t.rasterizedResource;if(!l)continue;const f=l.size,m=t.offsetX,u=t.offsetY,y=t.anchorX,g=t.anchorY,d=t.rotateClockWise||!1;let p=t.angle,b=Object(r["c"])(m)-f[0]*(.5+y),O=Object(r["c"])(u)-f[1]*(.5+g),S=b+f[0],x=O+f[1];if(p){d&&(p=-p);const e=Math.sin(p*Math.PI/180),t=Math.cos(p*Math.PI/180),i=b*t-O*e,r=b*e+O*t,n=b*t-x*e,o=b*e+x*t,a=S*t-x*e,s=S*e+x*t,c=S*t-O*e,l=S*e+O*t;b=Math.min(i,n,a,c),O=Math.min(r,o,s,l),S=Math.max(i,n,a,c),x=Math.max(r,o,s,l)}n=b<n?b:n,o=O<o?O:o,a=S>a?S:a,s=x>s?x:s;const C=i.createImageData(l.size[0],l.size[1]);C.data.set(new Uint8ClampedArray(l.image.buffer));const v={offsetX:m,offsetY:u,rotateClockwise:d,angle:p,rasterizedImage:C,anchorX:y,anchorY:g};c.push(v)}t.width=a-n,t.height=s-o;const l=-n,f=s;for(let h=0;h<c.length;h++){const e=c[h],t=this._imageDataToCanvas(e.rasterizedImage),n=e.rasterizedImage.width,o=e.rasterizedImage.height,a=l-n*(.5+e.anchorX),s=f-o*(.5-e.anchorY);if(e.angle){const n=(360-e.angle)*Math.PI/180;i.save(),i.translate(Object(r["c"])(e.offsetX),-Object(r["c"])(e.offsetY)),i.translate(l,f),i.rotate(n),i.translate(-l,-f),i.drawImage(t,a,s),i.restore()}else i.drawImage(t,a+Object(r["c"])(e.offsetX),s-Object(r["c"])(e.offsetY))}const m=new b["b"]({x:l/t.width-.5,y:f/t.height-.5});return{imageData:0!==t.width&&0!==t.height?i.getImageData(0,0,t.width,t.height):i.createImageData(1,1),anchorPosition:m}}_imageDataToCanvas(e){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));const t=this._imageDataCanvas,i=t.getContext("2d");return t.width=e.width,t.height=e.height,i.putImageData(e,0,0),t}_imageTo32Array(e,t,i){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));const r=this._imageDataCanvas,n=r.getContext("2d");return r.width=t,r.height=i,n.drawImage(e,0,0,t,i),new Uint32Array(n.getImageData(0,0,t,i).data.buffer)}_getRasterizedResource(e,t,i,r,n,o){let s,c,l,f;if("esriGeometryPolyline"===i||"esriGeometryPolygon"===i){const f=r&&r.style?r.style:g.Legend,m="esriGeometryPolyline"===i?S.stroke[f]:S.fill[f];if("line"===e.type){if("CIMSolidStroke"!==e.cim.type){if("CIMPictureStroke"===e.cim.type){const i=Object(d["d"])(e.width,t,n,o),{image:r,width:a,height:s}=this._getPictureResource(e,i);return this._rasterizePictureResource(e,r,a,s,m,i)}return null}({analyzedCIM:s,hash:l}=M(e,t,n,o)),c=this._embedCIMLayerInVectorMarker(s,m)}else if("marker"===e.type){if("CIMPictureMarker"===e.cim.type)return null;if("CIMVectorMarker"!==e.cim.type)return null;e.cim.offsetX=Object(d["d"])(e.offsetX,t,n,o),e.cim.offsetY=Object(d["d"])(e.offsetY,t,n,o),e.cim.rotation=Object(d["d"])(e.rotation,t,n,o),e.cim.markerPlacement=e.markerPlacement,({analyzedCIM:s}=M(e,t,n,o)),l=Object(a["b"])(JSON.stringify(s)).toString(),c=this._embedCIMLayerInVectorMarker(s,m)}else{if("text"===e.type)return null;if("fill"===e.type){if("CIMHatchFill"===e.cim.type||"CIMVectorMarker"===e.cim.type||"CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type){const i=e.cim.size||e.cim.height;let r,a,c;if("CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type)({image:r,width:a,height:c}=this._getPictureResource(e,i));else{({analyzedCIM:s,hash:l}=M(e,t,n,o));const i=this._rasterizer.rasterizeJSONResource(s,1,this._avoidSDF);r=i.image,a=i.size[0],c=i.size[1]}return this._rasterizePictureResource(e,r,a,c,m,null)}if("CIMSolidFill"!==e.cim.type)return null;({analyzedCIM:s,hash:l}=M(e,t,n,o)),c=this._embedCIMLayerInVectorMarker(s,m)}}}else{if("text"===e.type)return f=this._rasterizeTextResource(e,t,r,n,o),f;({analyzedCIM:s,hash:l}=M(e,t,n,o));const i=O(r,e,null);if("CIMPictureMarker"===e.cim.type){const r=Object(d["d"])(e.size,t,n,o)*i,{image:a,width:s,height:c}=this._getPictureResource(e,r);return f={image:a,size:[s,c],sdf:!1,simplePattern:!1,anchorX:e.anchorPoint?e.anchorPoint.x:0,anchorY:e.anchorPoint?e.anchorPoint.y:0},f}Object(p["c"])(s,i,{preserveOutlineWidth:!1}),c=s}l+=i,r&&(l+=JSON.stringify(r));const m=this._resourceCache;return m.has(l)?m.get(l):(f=this._rasterizer.rasterizeJSONResource(c,window.devicePixelRatio||1,this._avoidSDF),m.set(l,f),f)}_rasterizeTextResource(e,t,i,r,n){const o=O(i,e,null),a=Object(d["d"])(e.text,t,r,n);if(!a||0===a.length)return null;const s=Object(d["d"])(e.fontName,t,r,n),c=Object(d["d"])(e.style,t,r,n),l=Object(d["d"])(e.weight,t,r,n),f=Object(d["d"])(e.decoration,t,r,n),m=Object(d["d"])(e.size,t,r,n)*o,h=Object(d["d"])(e.horizontalAlignment,t,r,n),u=Object(d["d"])(e.verticalAlignment,t,r,n),y=Object(d["b"])(Object(d["d"])(e.color,t,r,n)),g=Object(d["b"])(Object(d["d"])(e.outlineColor,t,r,n)),p={color:y,size:m,horizontalAlignment:h,verticalAlignment:u,font:{family:s,style:c,weight:l,decoration:f},halo:{size:Object(d["d"])(e.outlineSize,t,r,n)||0,color:g,style:c},pixelRatio:1,premultiplyColors:!this._avoidSDF};return this._textRasterizer.rasterizeText(a,p)}_rasterizePictureResource(e,t,i,n,o,a){const c=document.createElement("canvas"),l=c.getContext("2d");c.height=Object(r["c"])(Math.max(Math.abs(o.frame.ymax-o.frame.ymin),a)),c.width=Object(r["c"])(Math.abs(o.frame.xmax-o.frame.xmin));const f=l.createImageData(i,n);f.data.set(new Uint8ClampedArray(t.buffer));const m=this._imageDataToCanvas(f),h=l.createPattern(m,"repeat"),u=Math.cos((-e.cim.rotation||0)*Math.PI/180),y=Math.sin((-e.cim.rotation||0)*Math.PI/180);h.setTransform({m11:u,m12:y,m21:-y,m22:u,m41:Object(r["c"])(e.cim.offsetX)||0,m42:Object(r["c"])(e.cim.offsetY)||0});const g=o.canvasPaths;let d,p,b;Object(s["g"])(g)?(d=g.rings,l.fillStyle=h,p=l.fill,b=["evenodd"]):Object(s["h"])(g)&&(d=g.paths,l.strokeStyle=h,l.lineWidth=a,p=l.stroke,d[0][0][1]=c.height/2,d[0][1][1]=c.height/2),l.beginPath();for(const s of d){const e=s?s.length:0;if(e>1){let t=s[0];l.moveTo(Object(r["c"])(t[0]),Object(r["c"])(t[1]));for(let i=1;i<e;++i)t=s[i],l.lineTo(Object(r["c"])(t[0]),Object(r["c"])(t[1]));l.closePath()}}p.apply(l,b);const O=l.getImageData(0,0,c.width,c.height),S=new Uint8Array(O.data);return{size:[c.width,c.height],image:new Uint32Array(S.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}_getPictureResource(e,t){const i=this._pictureMarkerCache.get(e.materialHash);if(!i)return null;const n=i.height/i.width,o=t?n>1?Object(r["c"])(t):Object(r["c"])(t)/n:i.width,a=t?n>1?Object(r["c"])(t)*n:Object(r["c"])(t):i.height;return{image:this._imageTo32Array(i,o,a),width:o,height:a}}_embedCIMLayerInVectorMarker(e,t){const i=Object(s["g"])(t.geometry)?"CIMPolygonSymbol":"CIMLineSymbol";return{type:"CIMVectorMarker",frame:t.frame,markerGraphics:[{type:"CIMMarkerGraphic",geometry:t.geometry,symbol:{type:i,symbolLayers:[e]}}]}}}function C(e){return(e?Object.keys(e):[]).map(t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"}))}function v(e){if(!(e&&e.data&&e.data.symbol))return null;switch(e.data.symbol.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function M(e,t,i,r){let n,o;return"function"==typeof e.materialHash?(n=(0,e.materialHash)(t,i,r),o=Object(c["a"])(e.cim,e.materialOverrides)):(n=e.materialHash,o=e.cim),{analyzedCIM:o,hash:n}}const w=new x(null,!0),P=120;async function k(e,t={}){const{size:i,maxSize:n,node:o,opacity:a}=t,s=t.cimOptions||t,{feature:c,fieldMap:l,geometryType:f,style:m}=s,h=Object(p["b"])(e),u=Math.min(null!=i?i:h,null!=n?n:Object(r["d"])(P));u!==h&&(e=e.clone(),Object(p["d"])(e,u,{preserveOutlineWidth:!0}));let y=3;e&&e.data&&e.data.symbol&&"CIMPointSymbol"!==e.data.symbol.type&&(y=1);const g=await w.rasterizeCIMSymbolAsync(e,c,l,f,{scaleFactor:y,style:m}),d=document.createElement("canvas");d.width=g.imageData.width,d.height=g.imageData.height,d.getContext("2d").putImageData(g.imageData,0,0);let b=d.width/y,O=d.height/y;if(null!=i&&(null==(null==t?void 0:t.scale)||(null==t?void 0:t.scale))){const e=b/O;b=e<=1?Math.ceil(u*e):u,O=e<=1?u:Math.ceil(u/e)}const S=new Image(b,O);return S.src=d.toDataURL(),null!=a&&(S.style.opacity=""+a),o&&o.appendChild(S),S}}}]);
//# sourceMappingURL=chunk-73371494.93263c9d.js.map